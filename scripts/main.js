!function e(t,r,n){function o(i,d){if(!r[i]){if(!t[i]){var s="function"==typeof require&&require;if(!d&&s)return s(i,!0);if(a)return a(i,!0);var c=new Error("Cannot find module '"+i+"'");throw c.code="MODULE_NOT_FOUND",c}var h=r[i]={exports:{}};t[i][0].call(h.exports,function(e){var r=t[i][1][e];return o(r||e)},h,h.exports,e,t,r,n)}return r[i].exports}for(var a="function"==typeof require&&require,i=0;i<n.length;i++)o(n[i]);return o}({1:[function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function o(){var e=$("#xgFileSelect").val();$.ajax({type:"POST",url:f+"/getPathNames",crossDomain:!0,data:{xgFile:e},dataType:"json",success:function(e){document.getElementById("pathNameSelect");e.pathNames.forEach(function(e){document.createElement("option");$("#pathNameSelect").append('<option value="'+e+'" selected>'+e+"</option>")})},error:function(e,t,r){console.log("POST failed.")}})}function a(){d3.select("#svg").selectAll("*").remove(),d3.select("#svg").attr("width",100);var e=$(".tubeMapSVG").width();$("#legendDiv").html(""),document.getElementById("loader").setAttribute("style","left:"+(e/2-25)+"px"),i()}function i(){var e=document.getElementById("position").value,t=document.getElementById("distance").value,r=0!==document.getElementById("unitSelect").selectedIndex,n=$("#xgFileSelect").val(),o=$("#gbwtFileSelect").val(),a=$("#gamIndexSelect").val(),i=$("#pathNameSelect").val(),s=!0;g.forEach(function(e){e.name===$("#dataSourceSelect").val()&&(console.log("found"),n=e.xgFile,o=e.gbwtFile,a=e.gamIndex,i=e.anchorTrackName,s=e.useMountedPath)}),console.log("useMountedPath = "+s),console.log("anchorTrackName = "+i),$.ajax({type:"POST",url:f+"/chr22_v4",crossDomain:!0,data:{nodeID:e,distance:t,byNode:r,xgFile:n,gbwtFile:o,gamIndex:a,anchorTrackName:i,useMountedPath:s},dataType:"json",success:function(e){if($.isEmptyObject(e))return console.log("empty"),void(document.getElementById("loader").style.display="none");var t=u.vgExtractNodes(e.graph),r=u.vgExtractTracks(e.graph);d(t,r,u.vgExtractReads(t,r,e.gam))},error:function(e,t,r){console.log("POST failed.")}})}function d(e,t,r){u.create({svgID:"#svg",nodes:e,tracks:t,reads:r}),document.getElementById("loader").style.display="none"}function s(){$.ajax({type:"POST",url:f+"/getFilenames",crossDomain:!0,success:function(e){var t=document.getElementById("xgFileSelect");e.xgFiles.forEach(function(e){var r=document.createElement("option");r.value=e,r.innerHTML=e,t.appendChild(r)});var r=document.getElementById("gbwtFileSelect");e.gbwtFiles.forEach(function(e){var t=document.createElement("option");t.value=e,t.innerHTML=e,r.appendChild(t)});var n=document.getElementById("gamIndexSelect");e.gamIndices.forEach(function(e){var t=document.createElement("option");t.value=e,t.innerHTML=e,n.appendChild(t)})},error:function(e,t,r){console.log("POST failed.")}})}var c=e("merge-json"),h=n(c),l=e("./tubemap"),u=n(l),p=e("../../config.default.json");try{p=h.merge(p,e("../../config.json"))}catch(e){}var f=p.BACKEND_URL||"http://"+window.location.host,g=p.DATA_SOURCES;$("#dataSourceSelect").change(function(){$("#distance").prop("value","100"),$("#unitSelect").prop("value","1"),"custom"===$("#dataSourceSelect").val()?($("#xgFileSelect").prop("disabled",!1),$("#gbwtFileSelect").prop("disabled",!1),$("#gamIndexSelect").prop("disabled",!1),$("#pathNameSelect").prop("disabled",!1),$("#position").prop("value","1")):($("#xgFileSelect").prop("disabled",!0),$("#gbwtFileSelect").prop("disabled",!0),$("#gamIndexSelect").prop("disabled",!0),$("#pathNameSelect").prop("disabled",!0),g.forEach(function(e){e.name===$("#dataSourceSelect").val()&&$("#position").prop("value",e.defaultPosition)}))}),$("#xgFileSelect").change(function(){$("#pathNameSelect").empty(),"none"===$("#xgFileSelect").val()||o()}),document.getElementById("goButton").onclick=function(){a()},document.getElementById("goLeftButton").onclick=function(){var e=Number(document.getElementById("position").value),t=Number(document.getElementById("distance").value);document.getElementById("position").value=Math.max(e-t,0),a()},document.getElementById("goRightButton").onclick=function(){var e=Number(document.getElementById("position").value),t=Number(document.getElementById("distance").value);document.getElementById("position").value=e+t,a()},document.getElementById("redundantNodesCheckbox").onclick=function(){!0===document.getElementById("redundantNodesCheckbox").checked?u.setMergeNodesFlag(!0):u.setMergeNodesFlag(!1)},document.getElementById("compressedViewCheckbox").onclick=function(){!0===document.getElementById("compressedViewCheckbox").checked?u.setNodeWidthOption(1):u.setNodeWidthOption(0)},document.getElementById("showReadsCheckbox").onclick=function(){!0===document.getElementById("showReadsCheckbox").checked?u.setShowReadsFlag(!0):u.setShowReadsFlag(!1)},document.getElementById("softClipsCheckbox").onclick=function(){!0===document.getElementById("softClipsCheckbox").checked?u.setSoftClipsFlag(!0):u.setSoftClipsFlag(!1)};for(var y=document.getElementsByClassName("colorRadio"),m=0;m<y.length;m+=1)!function(e){var t=void 0;switch(y[e].name){case"colorsHaplo":t="haplotypeColors";break;case"colorsFwReads":t="forwardReadColors";break;case"colorsRevReads":t="reverseReadColors";break;default:console.log("Could not find track type in color set assignment")}var r=void 0;switch(y[e].value){case"option1":r="plainColors";break;case"option2":r="greys";break;case"option3":r="reds";break;case"option4":r="blues";break;case"option5":r="lightColors";break;default:console.log("Could not find color type in color set assignment")}y[e].onclick=function(){console.log(this),u.setColorSet(t,r)}}(m);document.getElementById("downloadButton").onclick=function(){var e=document.getElementById("svg"),t=(new XMLSerializer).serializeToString(e),r=new Blob([t],{type:"image/svg+xml;charset=utf-8"}),n=URL.createObjectURL(r),o=document.createElement("a");o.href=n,o.download="graph.svg",document.body.appendChild(o),o.click(),document.body.removeChild(o)},window.onload=function(){var e=document.getElementById("dataSourceSelect");g.forEach(function(t){var r=document.createElement("option");r.value=t.name,r.innerHTML=t.name,e.appendChild(r)});var t=document.createElement("option");t.value="custom",t.innerHTML="custom",e.appendChild(t),document.getElementById("goButton").click(),s()}},{"../../config.default.json":3,"../../config.json":4,"./tubemap":2,"merge-json":5}],2:[function(e,t,r){"use strict";function n(e){nt=e.svgID,ot=d3.select(e.svgID),at=JSON.parse(JSON.stringify(e.nodes)),it=JSON.parse(JSON.stringify(e.tracks)),dt=e.reads||null,It=e.bed||null,wt.clickableNodesFlag=e.clickableNodes||!1,wt.hideLegendFlag=e.hideLegend||!1;p();wt.hideLegendFlag||ke()}function o(e){it.unshift(it[e]),it.splice(e+1,1),a(0)}function a(e){var t=void 0,r=void 0,n=[],o=void 0,a=void 0;for(o=it[e].sequence,t=0;t<o.length;t+=1)"-"===o[t].charAt(0)&&(a=o[t].substr(1),(-1===o.indexOf(a)||o.indexOf(a)>t)&&n.push(o[t].substr(1)));for(t=0;t<it.length;t+=1)for(o=it[t].sequence,r=0;r<o.length;r+=1)"-"!==o[r].charAt(0)?-1!==n.indexOf(o[r])&&(o[r]="-"+o[r]):-1!==n.indexOf(o[r].substr(1))&&(o[r]=o[r].substr(1));at.forEach(function(e){-1!==n.indexOf(e.name)&&(e.seq=e.seq.split("").reverse().join(""))})}function i(e){for(var t=0;t<it.length&&it[t].id!==e;)t+=1;t<it.length&&(it[t].hasOwnProperty("hidden")?it[t].hidden=!it[t].hidden:it[t].hidden=!0),p()}function d(){wt.showExonsFlag=!wt.showExonsFlag,p()}function s(e){wt.mergeNodesFlag!==e&&(wt.mergeNodesFlag=e,ot=d3.select(nt),p())}function c(e){wt.showSoftClips!==e&&(wt.showSoftClips=e,ot=d3.select(nt),p())}function h(e){wt.showReads!==e&&(wt.showReads=e,ot=d3.select(nt),p())}function l(e,t){wt[e]=t;p();wt.hideLegendFlag||ke()}function u(e){0!==e&&1!==e&&2!==e||wt.nodeWidthOption!==e&&(wt.nodeWidthOption=e,void 0!==ot&&(ot=d3.select(nt),p()))}function p(){xt=[],Et=[],bt=[],kt=[],St=[],gt=[],yt=[],mt=[],qt=0,Ft=0,Ot=0,Nt=void 0,ot=d3.select(nt),ot.selectAll("*").remove(),st=JSON.parse(JSON.stringify(at)),ct=JSON.parse(JSON.stringify(it)),ht=JSON.parse(JSON.stringify(dt)),re();for(var e=ct.length-1;e>=0;e-=1)ct[e].hasOwnProperty("type")||(ct[e].type="haplo"),ct[e].hasOwnProperty("hidden")&&!0===ct[e].hidden&&ct.splice(e,1),ct[e].hasOwnProperty("indexOfFirstBase")&&(Nt=ct[e].name);pt=C(),F(ct),ht&&wt.showReads&&F(ht),Me(),ht&&wt.mergeNodesFlag&&(M(),D(),ht&&wt.showReads&&S(),De(),pt=C(),Me(),F(ct),ht&&wt.showReads&&F(ht)),lt=st.length,ut=ct.length,M(),H(),Je&&console.log(lt+" nodes."),D(),vt=B(),ee(),j(),!0===wt.showExonsFlag&&null!==It&&K(),U(),ht&&wt.showReads&&(f(),S(),F(ht),y(),ct=ct.concat(ht)),se(),console.log("Tracks:"),console.log(ct),console.log("Nodes:"),console.log(st),console.log("Lane assignment:"),console.log(gt),N(),I(),xe(),ve(xt),Ee(),ue(bt,kt),ve(St),ve(xt,"read"),Ee("read");var t=O(st);return pe(t),ue(bt,kt,"read"),0===wt.nodeWidthOption&&fe(t),void 0!==Nt&&ge(),0===wt.nodeWidthOption&&Re(),Je&&(console.log("number of tracks: "+ut),console.log("number of nodes: "+lt)),ct}function f(){ft=[];for(var e=0;e<=vt;e+=1)ft[e]=[];var t=new Map;st.forEach(function(e){e.hasOwnProperty("order")&&e.hasOwnProperty("y")&&(t.has(e.order)?t.set(e.order,Math.max(e.y+e.contentHeight,t.get(e.order))):t.set(e.order,e.y+e.contentHeight))}),st.forEach(function(e,r){e.hasOwnProperty("order")&&!e.hasOwnProperty("y")&&(console.log("adding to "+e.name),e.y=t.get(e.order)+25,e.contentHeight=0,ft[e.order].push(r))})}function g(){st.forEach(function(e){e.incomingReads=[],e.outgoingReads=[],e.internalReads=[]}),ht.forEach(function(e,t){e.width=7,1===e.path.length?st[e.path[0].node].internalReads.push(t):e.path.forEach(function(r,n){0===n?st[e.path[0].node].outgoingReads.push([t,n]):null!==e.path[n].node&&st[e.path[n].node].incomingReads.push([t,n])})})}function y(){k(),g();var e=st.slice();e.sort(X),e.forEach(function(e){e.incomingReads.sort(x);var t=e.y+e.contentHeight,r=new Map;e.incomingReads.forEach(function(n){ht[n[0]].path[n[1]].y=t,m(r,ht[n[0]],n[1],t,e),t+=7});var n=t;e.outgoingReads.sort(w);var o=new Map;t=e.y+e.contentHeight,e.outgoingReads.forEach(function(a){ht[a[0]].path[a[1]].y=t,o.set(t,ht[a[0]].firstNodeOffset),!r.has(t)||r.get(t)+1<ht[a[0]].firstNodeOffset?(t+=7,n=Math.max(n,t)):(r.set(t,0),e.incomingReads.forEach(function(n){var o=ht[n[0]],a=o.path[n[1]];a.y>=t&&(a.y+=7,m(r,o,n[1],a.y,e))}),t+=7,n+=7)}),e.internalReads.sort(E),e.internalReads.forEach(function(a){var i=ht[a];for(t=e.y+e.contentHeight;i.firstNodeOffset<r.get(t)+2||i.finalNodeCoverLength>o.get(t)-3;)t+=7;i.path[0].y=t,r.set(t,i.finalNodeCoverLength),n=Math.max(n,t)});var a=n-e.y-e.contentHeight;e.contentHeight+=a,V(e,a)});var t=b(),r=[];ht.forEach(function(e,t){e.path.forEach(function(e,n){e.hasOwnProperty("y")||r.push({readIndex:t,pathIndex:n,previousY:ht[t].path[n-1].y})})}),r.sort(v),r.forEach(function(e){var r=ht[e.readIndex].path[e.pathIndex];r.y=t[r.order],t[r.order]+=ht[e.readIndex].width}),console.log("Reads:"),console.log(ht)}function m(e,t,r,n,o){r===t.path.length-1?e.set(n,t.finalNodeCoverLength):e.set(n,o.sequenceLength)}function v(e,t){var r=ht[e.readIndex].path[e.pathIndex],n=ht[t.readIndex].path[t.pathIndex];return r.order===n.order?e.previousY-t.previousY:r.order-n.order}function w(e,t){for(var r=e[1],n=t[1],o=st[ht[e[0]].path[r].node],a=st[ht[t[0]].path[n].node];null!==o&&null!==a&&o===a;){if(r<ht[e[0]].path.length-1){for(r+=1;null===ht[e[0]].path[r].node;)r+=1;o=st[ht[e[0]].path[r].node]}else o=null;if(n<ht[t[0]].path.length-1){for(n+=1;null===ht[t[0]].path[n].node;)n+=1;a=st[ht[t[0]].path[n].node]}else a=null}if(null!==o)return null!==a?X(o,a):1;if(null!==a)return-1;var i=ht[e[0]].firstNodeOffset-ht[t[0]].firstNodeOffset;return 0!==i?i:ht[e[0]].finalNodeCoverLength-ht[t[0]].finalNodeCoverLength}function x(e,t){var r=ht[e[0]].path[e[1]-1],n=ht[t[0]].path[t[1]-1];return r.hasOwnProperty("y")?n.hasOwnProperty("y")?r.y-n.y:-1:n.hasOwnProperty("y")?1:x([e[0],e[1]-1],[t[0],t[1]-1])}function E(e,t){var r=ht[e],n=ht[t];return r.firstNodeOffset<n.firstNodeOffset?-1:r.firstNodeOffset>n.firstNodeOffset?1:r.finalNodeCoverLength<n.finalNodeCoverLength?-1:r.finalNodeCoverLength>n.finalNodeCoverLength?1:0}function b(){for(var e=[],t=0;t<=vt;t+=1)e.push(0);return st.forEach(function(t){e[t.order]=Math.max(e[t.order],t.y+t.contentHeight+20)}),ct.forEach(function(t){t.path.forEach(function(r){e[r.order]=Math.max(e[r.order],r.y+t.width)})}),e}function k(){var e=void 0,t=void 0,r=void 0,n=void 0,o=void 0,a=function(e){return((e=+e)||1/e)>=0};ht.forEach(function(i){e=Math.abs(i.indexSequence[0]),t=a(i.indexSequence[0]),r=st[e],i.path=[],i.path.push({order:r.order,isForward:t,node:e});for(var d=1;d<i.sequence.length;d+=1)if(n=r,o=t,e=Math.abs(i.indexSequence[d]),t=a(i.indexSequence[d]),r=st[e],r.order>n.order){o||i.path.push({order:n.order,isForward:!0,node:null});for(var s=n.order+1;s<r.order;s+=1)i.path.push({order:s,isForward:!0,node:null});t?i.path.push({order:r.order,isForward:!0,node:e}):(i.path.push({order:r.order,isForward:!0,node:null}),i.path.push({order:r.order,isForward:!1,node:e}))}else if(r.order<n.order){o&&i.path.push({order:n.order,isForward:!1,node:null});for(var c=n.order-1;c>r.order;c-=1)i.path.push({order:c,isForward:!1,node:null});t?(i.path.push({order:r.order,isForward:!1,node:null}),i.path.push({order:r.order,isForward:!0,node:e})):i.path.push({order:r.order,isForward:!1,node:e})}else t!==o?i.path.push({order:r.order,isForward:t,node:e}):(i.path.push({order:r.order,isForward:!t,node:null}),i.path.push({order:r.order,isForward:t,node:e}))})}function S(){ht.forEach(function(e){for(var t=0;t<e.sequence.length&&"-"===e.sequence[t].charAt(0);)t+=1;if(t===e.sequence.length){e.is_reverse=!0,e.sequence=e.sequence.reverse();for(var r=0;r<e.sequence.length;r+=1)e.sequence[r]=e.sequence[r].substr(1);e.sequenceNew=e.sequenceNew.reverse();for(var n=0;n<e.sequenceNew.length;n+=1)!function(t){e.sequenceNew[t].nodeName=e.sequenceNew[t].nodeName.substr(1);var r=st[pt.get(e.sequenceNew[t].nodeName)].width;e.sequenceNew[t].mismatches.forEach(function(e){"insertion"===e.type?(e.pos=r-e.pos,e.seq=q(e.seq)):"deletion"===e.type?e.pos=r-e.pos-e.length:"substitution"===e.type&&(e.pos=r-e.pos-e.seq.length,e.seq=q(e.seq)),e.hasOwnProperty("seq")&&(e.seq=e.seq.split("").reverse().join(""))})}(n);var o=e.firstNodeOffset,a=st[pt.get(e.sequence[0])].sequenceLength;e.firstNodeOffset=a-e.finalNodeCoverLength,a=st[pt.get(e.sequence[e.sequence.length-1])].sequenceLength,e.finalNodeCoverLength=a-o}})}function q(e){for(var t="",r=e.length-1;r>=0;r-=1)switch(e.charAt(r)){case"A":t+="T";break;case"T":t+="A";break;case"C":t+="G";break;case"G":t+="C";break;default:t+="N"}return t}function F(e){e.forEach(function(e){e.indexSequence=[],e.sequence.forEach(function(t){"-"===t.charAt(0)?e.indexSequence.push(-pt.get(t.substr(1))):e.indexSequence.push(pt.get(t))})})}function O(e){var t=e.slice(0),r=void 0;for(r=t.length-1;r>=0;r-=1)t[r].hasOwnProperty("x")||t.splice(r,1);return t}function N(){Ot=-99,Ft=99,qt=-99,st.forEach(function(e){e.hasOwnProperty("x")&&(Ot=Math.max(Ot,e.x+20+e.pixelWidth)),e.hasOwnProperty("y")&&(Ft=Math.min(Ft,e.y-10),qt=Math.max(qt,e.y+e.contentHeight+10))}),ct.forEach(function(e){e.path.forEach(function(t){qt=Math.max(qt,t.y+e.width),Ft=Math.min(Ft,t.y)})})}function I(){var e=d3.behavior.zoom().scaleExtent([.1,5]).on("zoom",function(){ot.attr("transform","translate("+d3.event.translate+") scale("+d3.event.scale+")")});ot=ot.call(e).on("dblclick.zoom",null).append("g"),e.translate([0,25-Ft]),e.event(ot);var t=d3.select(nt);t.attr("height",qt-Ft+50),t.attr("width",Math.max(Ot,$(nt).parent().width()))}function C(){return pt=new Map,st.forEach(function(e,t){pt.set(e.name,t)}),pt}function M(){var e=void 0,t=void 0;st.forEach(function(e){e.successors=[],e.predecessors=[]}),ct.forEach(function(r){for(var n=0;n<r.indexSequence.length-1;n+=1)e=Math.abs(r.indexSequence[n]),t=Math.abs(r.indexSequence[n+1]),-1===st[e].successors.indexOf(t)&&st[e].successors.push(t),-1===st[t].predecessors.indexOf(e)&&st[t].predecessors.push(e)}),ht&&wt.showReads&&ht.forEach(function(r){for(var n=0;n<r.indexSequence.length-1;n+=1)e=Math.abs(r.indexSequence[n]),t=Math.abs(r.indexSequence[n+1]),-1===st[e].successors.indexOf(t)&&st[e].successors.push(t),-1===st[t].predecessors.indexOf(e)&&st[t].predecessors.push(e)})}function P(e){var t=0,r=0,n=void 0,o=0;e.forEach(function(e){e<0?(n=st[Math.abs(e)],n.hasOwnProperty("order")||(n.order=r),n.order<o&&(o=n.order),t=n.order,r=n.order-1):(n=st[e],n.hasOwnProperty("order")||(n.order=t),t=n.order+1,r=n.order)}),o<0&&T(-o)}function L(e){for(var t=0,r=void 0,n=void 0,o=0,a=void 0;t<e.length&&!st[Math.abs(e[t])].hasOwnProperty("order");)t+=1;if(t>=e.length)return null;e[t]>=0?(r=st[e[t]].order-1,a=-1):(r=st[-e[t]].order+1,a=1);for(var i=t-1;i>=0;i-=1)n=st[Math.abs(e[i])],n.hasOwnProperty("order")||(n.order=r,o=Math.min(o,r),r+=a);return o<0&&T(-o),t}function D(){var e=void 0,t=void 0,r=void 0,n=void 0,o=void 0,a=0,i=void 0;i=ht&&wt.showReads?ct.concat(ht):ct,st.forEach(function(e){delete e.order}),P(ct[0].indexSequence);for(var d=1;d<i.length;d+=1)if(Je&&console.log("generating order for track "+(d+1)),null!==(n=L(i[d].indexSequence)))for(e=R(i[d].indexSequence);n<e.length;){for(o=n,n+=1;n<e.length&&!st[e[n]].hasOwnProperty("order");)n+=1;if(n<e.length){t=st[e[o]].order+1;for(var s=o+1;s<n;s+=1)st[e[s]].order=t,t+=1;if(st[e[n]].order>st[e[o]].order)st[e[n]].order<t&&_(e[n],e[n-1],t);else if(i[d].indexSequence[n]>=0&&!A(e[n],e[o]))_(e[n],e[n-1],t);else if(i[d].sequence[o]<0||st[e[o+1]].degree<2&&st[e[n]].order<st[e[o]].order){t=st[e[o]].order-1;for(var c=o+1;c<n;c+=1)st[e[c]].order=t,t-=1}}else if(i[d].sequence[o]>=0){t=st[e[o]].order+1;for(var h=o+1;h<e.length;h+=1)r=st[e[h]],r.hasOwnProperty("order")||(r.order=t,t+=1)}else{t=st[e[o]].order-1;for(var l=o+1;l<e.length;l+=1)r=st[e[l]],r.hasOwnProperty("order")||(r.order=t,a=Math.min(a,t),t-=1)}}else i.splice(d,1),ht.splice(d-ct.length,1),d-=1;a<0&&T(-a)}function A(e,t){var r=new Array(lt).fill(!1),n=[];for(n.push(e),r[e]=!0;n.length>0;){var o=n.pop();if(o===t)return!0;for(var a=0;a<st[o].successors.length;a+=1){var i=st[o].successors[a];r[i]||(r[i]=!0,n.push(i))}}return!1}function B(){var e=-1;return st.forEach(function(t){t.hasOwnProperty("order")&&t.order>e&&(e=t.order)}),e}function R(e){for(var t=[],r=0;r<e.length;r+=1)e[r]>=0?t.push(e[r]):t.push(-e[r]);return t}function T(e){st.forEach(function(t){t.hasOwnProperty("order")&&(t.order+=e)})}function _(e,t,r){var n=new Map,o=[];o.push([e,r]);for(;o.length>0;)!function(){var r=o.shift(),a=r[0],i=r[1];st[a].hasOwnProperty("order")&&st[a].order<i&&(!n.has(a)||n.get(a)<i)&&(n.set(a,i),st[a].successors.forEach(function(e){st[e].order>st[a].order&&e!==t&&o.push([e,i+1])}),a!==e&&st[a].predecessors.forEach(function(e){st[e].order>a.order&&e!==t&&o.push([e,i+1])}))}();n.forEach(function(e,t){st[t].order=e})}function H(){st.forEach(function(e){e.tracks=[]}),ct.forEach(function(e){e.indexSequence.forEach(function(t){st[Math.abs(t)].tracks.push(e.id)})}),st.forEach(function(e){e.hasOwnProperty("tracks")&&(e.degree=e.tracks.length)})}function U(){var e=0,t=20,r=-1,n=st.slice();n.sort(X);var o=W();n.forEach(function(n){n.hasOwnProperty("order")&&(n.order>r&&(r=n.order,e=t+10*o[n.order]),n.x=e,t=Math.max(t,e+40+n.pixelWidth))})}function W(){for(var e=[],t=[],r=[],n=0;n<=vt;n+=1)e.push(0),t.push(0);ct.forEach(function(r){for(var n=1;n<r.path.length;n+=1)r.path[n].order===r.path[n-1].order&&(!0===r.path[n].isForward?e[r.path[n].order]+=1:t[r.path[n].order]+=1)}),r.push(Math.max(0,e[0]-1));for(var o=1;o<=vt;o+=1)r.push(Math.max(0,e[o]-1)+Math.max(0,t[o-1]-1));return r}function j(){for(var e=void 0,t=void 0,r=void 0,n=void 0,o=void 0,a=void 0,i=[],d=function(e){return((e=+e)||1/e)>=0},s=0;s<=vt;s+=1){gt[s]=[],i[s]=[];for(var c=0;c<ut;c+=1)i[s][c]=null}ct.forEach(function(s,c){t=Math.abs(s.indexSequence[0]),r=d(s.indexSequence[0]),n=st[t],s.path=[],s.path.push({order:n.order,lane:null,isForward:r,node:t}),Y(n.order,t,c,0,i),e=1;for(var h=1;h<s.sequence.length;h+=1)if(o=n,a=r,t=Math.abs(s.indexSequence[h]),r=d(s.indexSequence[h]),n=st[t],n.order>o.order){a||(s.path.push({order:o.order,lane:null,isForward:!0,node:null}),Y(o.order,null,c,e,i),e+=1);for(var l=o.order+1;l<n.order;l+=1)s.path.push({order:l,lane:null,isForward:!0,node:null}),Y(l,null,c,e,i),e+=1;r?(s.path.push({order:n.order,lane:null,isForward:!0,node:t}),Y(n.order,t,c,e,i),e+=1):(s.path.push({order:n.order,lane:null,isForward:!0,node:null}),Y(n.order,null,c,e,i),e+=1,s.path.push({order:n.order,lane:null,isForward:!1,node:t}),Y(n.order,t,c,e,i),e+=1)}else if(n.order<o.order){a&&(s.path.push({order:o.order,lane:null,isForward:!1,node:null}),Y(o.order,null,c,e,i),e+=1);for(var u=o.order-1;u>n.order;u-=1)s.path.push({order:u,lane:null,isForward:!1,node:null}),Y(u,null,c,e,i),e+=1;r?(s.path.push({order:n.order,lane:null,isForward:!1,node:null}),Y(n.order,null,c,e,i),e+=1,s.path.push({order:n.order,lane:null,isForward:!0,node:t}),Y(n.order,t,c,e,i),e+=1):(s.path.push({order:n.order,lane:null,isForward:!1,node:t}),Y(n.order,t,c,e,i),e+=1)}else r!==a?(s.path.push({order:n.order,lane:null,isForward:r,node:t}),Y(n.order,t,c,e,i),e+=1):(s.path.push({order:n.order,lane:null,isForward:!r,node:null}),Y(n.order,null,c,e,i),e+=1,s.path.push({order:n.order,lane:null,isForward:r,node:t}),Y(n.order,t,c,e,i),e+=1)});for(var h=0;h<=vt;h+=1)J(gt[h],h)}function Y(e,t,r,n,o){var a=o[e][r];if(null===t)gt[e].push({type:"single",node:null,tracks:[{trackID:r,segmentID:n,compareToFromSame:a}]}),o[e][r]=gt[e][gt[e].length-1].tracks[0];else{for(var i=0;i<gt[e].length;i+=1)if(gt[e][i].node===t)return gt[e][i].type="multiple",gt[e][i].tracks.push({trackID:r,segmentID:n,compareToFromSame:a}),void(o[e][r]=gt[e][i].tracks[gt[e][i].tracks.length-1]);gt[e].push({type:"single",node:t,tracks:[{trackID:r,segmentID:n,compareToFromSame:a}]}),o[e][r]=gt[e][gt[e].length-1].tracks[0]}}function Q(e,t){var r=void 0;e.forEach(function(e){e.idealLane=0,e.tracks.forEach(function(n){if(0===n.segmentID)n.idealLane=n.trackID,n.idealY=null;else if(ct[n.trackID].path[n.segmentID-1].order===t-1)n.idealLane=ct[n.trackID].path[n.segmentID-1].lane,n.idealY=ct[n.trackID].path[n.segmentID-1].y;else if(n.segmentID<ct[n.trackID].path.length-1&&ct[n.trackID].path[n.segmentID+1].order===t-1)n.idealLane=ct[n.trackID].path[n.segmentID+1].lane,n.idealY=ct[n.trackID].path[n.segmentID+1].y;else{for(r=n.segmentID-1;r>=0&&ct[n.trackID].path[r].order!==t-1;)r-=1;r<0?(n.idealLane=n.trackID,n.idealY=null):(n.idealLane=ct[n.trackID].path[r].lane,n.idealY=ct[n.trackID].path[r].y)}e.idealLane+=n.idealLane}),e.idealLane/=e.tracks.length})}function J(e,t){var r=0,n=new Set,o=20,a=!1,i=-1;Q(e,t),e.sort(G),e.forEach(function(e){null!==e.node?(st[e.node].topLane=r,a&&(o-=10),st[e.node].y=o,st[e.node].contentHeight=0,a=!1):(a?o-=25:o>20&&(o-=10),a=!0),e.tracks.sort(G),e.tracks.forEach(function(t){t.lane=r,t.trackID===i&&null===e.node&&a&&(o+=10),ct[t.trackID].path[t.segmentID].lane=r,ct[t.trackID].path[t.segmentID].y=o,null!==t.idealY&&n.add(t.idealY-o),r+=1,o+=ct[t.trackID].width,null!==e.node&&(st[e.node].contentHeight+=ct[t.trackID].width),i=t.trackID}),o+=25}),z(e,n)}function z(e,t){var r=0,n=Number.MAX_SAFE_INTEGER;t.forEach(function(t){Z(e,t)<n&&(n=Z(e,t),r=t)}),e.forEach(function(e){null!==e.node&&(st[e.node].y+=r),e.tracks.forEach(function(e){ct[e.trackID].path[e.segmentID].y+=r})})}function V(e,t){e.hasOwnProperty("order")&&(gt[e.order].forEach(function(r){if(null!==r.node){var n=st[r.node];n!==e&&n.y>e.y&&(n.y+=t,r.tracks.forEach(function(e){ct[e.trackID].path[e.segmentID].y+=t}))}else r.tracks.forEach(function(r){ct[r.trackID].path[r.segmentID].y>=e.y&&(ct[r.trackID].path[r.segmentID].y+=t)})}),ft[e.order].length>0&&ft[e.order].forEach(function(r){st[r]!==e&&st[r].y>e.y&&(st[r].y+=t)}))}function Z(e,t){var r=0;return e.forEach(function(e){e.tracks.forEach(function(e){null!==e.idealY&&"read"!==ct[e.trackID].type&&(r+=Math.abs(e.idealY-t-ct[e.trackID].path[e.segmentID].y)*ct[e.trackID].width)})}),r}function G(e,t){return e.hasOwnProperty("idealLane")?t.hasOwnProperty("idealLane")?e.idealLane<t.idealLane?-1:e.idealLane>t.idealLane?1:0:-1:t.hasOwnProperty("idealLane")?1:0}function X(e,t){if(null===e)return null===t?0:-1;if(null===t)return 1;if(e.hasOwnProperty("order")){if(t.hasOwnProperty("order")){if(e.order<t.order)return-1;if(e.order>t.order)return 1;if(e.hasOwnProperty("y")&&t.hasOwnProperty("y")){if(e.y<t.y)return-1;if(e.y>t.y)return 1}return 0}return-1}return t.hasOwnProperty("order")?1:0}function K(){var e=void 0,t=void 0,r={};It.forEach(function(n){for(var o=0;o<ut&&ct[o].name!==n.track;)o+=1;o<ut&&(e=0,ct[o].path.forEach(function(o){null!==o.node&&(r={},t=st[o.node].hasOwnProperty("sequenceLength")?e+st[o.node].sequenceLength-1:e+st[o.node].width-1,e>=n.start&&e<=n.end&&(r.start=0),e<n.start&&t>=n.start&&(r.start=n.start-e),t<=n.end&&t>=n.start&&(r.end=t-e,t<n.end&&(r.continue=!0)),t>n.end&&e<=n.end&&(r.end=n.end-e),r.hasOwnProperty("start")&&(r.type=n.type,r.name=n.name,o.hasOwnProperty("features")||(o.features=[]),o.features.push(r)),e=t+1)}))})}function ee(){var e=!0;ct.forEach(function(t){t.hasOwnProperty("freq")?t.width=Math.round(4*(Math.log(t.freq)+1)):(t.width=15,t.hasOwnProperty("type")&&"read"===t.type&&(t.width=4)),4!==t.width&&(e=!1)}),e&&ct.forEach(function(e){e.hasOwnProperty("freq")&&(e.width=15)})}function te(e){wt.colorScheme=e,ot=d3.select(nt);p();wt.hideLegendFlag||ke()}function re(){Ke=ne(wt.haplotypeColors),et=ne(wt.forwardReadColors),tt=ne(wt.reverseReadColors),rt=ne(wt.exonColors)}function ne(e){switch(e){case"plainColors":return Ge;case"reds":return Ze;case"blues":return Ve;case"greys":return ze;case"lightColors":return Xe;default:return ze}}function oe(e,t){void 0===t&&(t="plain");return e.hasOwnProperty("type")&&"read"===e.type?e.hasOwnProperty("is_reverse")&&!0===e.is_reverse?tt[e.id%tt.length]:et[e.id%et.length]:!1===wt.showExonsFlag||"plain"!==t?Ke[e.id%Ke.length]:rt[e.id%rt.length]}function ae(e){var t=st[e.path[0].node];return e.path[0].isForward?de(t,e.firstNodeOffset):de(t,t.sequenceLength-e.firstNodeOffset)}function ie(e){var t=st[e.path[e.path.length-1].node];return e.path[e.path.length-1].isForward?de(t,e.finalNodeCoverLength):de(t,t.sequenceLength-e.finalNodeCoverLength)}function de(e,t){if(t>e.sequenceLength)return null;var r=e.x-4,n=e.x+e.pixelWidth+4;return r+t/e.sequenceLength*(n-r)}function se(){for(var e=void 0,t=void 0,r=void 0,n=void 0,o=void 0,a=void 0,i=void 0,d=void 0,s=0;s<=vt;s+=1)yt.push(0),mt.push(0);var c=[],h=[];st.forEach(function(e){e.hasOwnProperty("order")&&(c[e.order]=e.x,void 0===h[e.order]?h[e.order]=e.x+e.pixelWidth:h[e.order]=Math.max(h[e.order],e.x+e.pixelWidth))}),ct.forEach(function(s){a="plain",o=oe(s,a),r=s.path[0].y,e="read"!==s.type?"-"===s.sequence[0].charAt(0)?h[s.path[0].order]+20:c[s.path[0].order]-20:ae(s);for(var l=0;l<s.path.length;l+=1)s.path[l].y===r?s.path[l].hasOwnProperty("features")&&(d=l>0&&s.path[l-1].order===s.path[l].order,i=ce(s.path[l],c[s.path[l].order],h[s.path[l].order],a,s,e,r,o,d),a=i.highlight,e=i.xStart):(t=s.path[l-1].isForward?h[s.path[l-1].order]:c[s.path[l-1].order],t!==e&&(o=oe(s,a),xt.push({xStart:Math.min(e,t),yStart:r,xEnd:Math.max(e,t),yEnd:r+s.width-1,color:o,id:s.id,type:s.type})),s.path[l].order-1===s.path[l-1].order?(e=t,t=c[s.path[l].order],n=s.path[l].y,o=oe(s,a),Et.push({xStart:e,yStart:r,xEnd:t+1,yEnd:n,width:s.width,color:o,laneChange:Math.abs(s.path[l].lane-s.path[l-1].lane),id:s.id,type:s.type}),e=t,r=n):s.path[l].order+1===s.path[l-1].order?(e=t,t=h[s.path[l].order],n=s.path[l].y,o=oe(s,a),Et.push({xStart:e+1,yStart:r,xEnd:t,yEnd:n,width:s.width,color:o,laneChange:Math.abs(s.path[l].lane-s.path[l-1].lane),id:s.id,type:s.type}),e=t,r=n):s.path[l-1].isForward?(n=s.path[l].y,he(t,r,n,s.width,o,s.id,s.path[l].order,s.type),e=h[s.path[l].order],r=s.path[l].y):(n=s.path[l].y,le(t,r,n,s.width,o,s.id,s.path[l].order,s.type),e=c[s.path[l].order],r=s.path[l].y),s.path[l].hasOwnProperty("features")&&(d=s.path[l-1].order===s.path[l].order,i=ce(s.path[l],c[s.path[l].order],h[s.path[l].order],a,s,e,r,o,d),a=i.highlight,e=i.xStart));t="read"!==s.type?s.path[s.path.length-1].isForward?h[s.path[s.path.length-1].order]+20:c[s.path[s.path.length-1].order]-20:ie(s),xt.push({xStart:Math.min(e,t),yStart:r,xEnd:Math.max(e,t),yEnd:r+s.width-1,color:o,id:s.id,type:s.type})})}function ce(e,t,r,n,o,a,i,d,s){var c=void 0,h=n,l=void 0,u=void 0,p=void 0,f=void 0;return t-=8,r+=8,c=st[e.node].hasOwnProperty("sequenceLength")?st[e.node].sequenceLength:st[e.node].width,e.features.sort(function(e,t){return e.start-t.start}),e.features.forEach(function(n){h!==n.type&&(l=oe(o,h),!0===e.isForward?(p=t+Math.round(n.start*(r-t+1)/c),s&&p<t+8&&(f=t+Math.round((n.end+1)*(r-t+1)/c)-1,u=oe(o,n.type),St.push({xStart:p,yStart:i,xEnd:f,yEnd:i+o.width-1,color:u,id:o.id,type:o.type})),p>a+1&&St.push({xStart:a,yStart:i,xEnd:p-1,yEnd:i+o.width-1,color:l,id:o.id,type:o.type})):(p=r-Math.round(n.start*(r-t+1)/c),s&&p>r-8&&(f=r-Math.round((n.end+1)*(r-t+1)/c)-1,u=oe(o,n.type),St.push({xStart:f,yStart:i,xEnd:p,yEnd:i+o.width-1,color:u,id:o.id,type:o.type})),a>p+1&&St.push({xStart:p+1,yStart:i,xEnd:a,yEnd:i+o.width-1,color:l,id:o.id,type:o.type})),a=p,h=n.type),(n.end<c-1||!n.hasOwnProperty("continue"))&&(l=oe(o,h),!0===e.isForward?(f=t+Math.round((n.end+1)*(r-t+1)/c)-1,St.push({xStart:a,yStart:i,xEnd:f,yEnd:i+o.width-1,color:l,id:o.id,type:o.type})):(f=r-Math.round((n.end+1)*(r-t+1)/c)-1,St.push({xStart:f,yStart:i,xEnd:a,yEnd:i+o.width-1,color:l,id:o.id,type:o.type})),a=f+1,h="plain")}),{xStart:a,highlight:h}}function he(e,t,r,n,o,a,i,d){e+=10*mt[i];var s=Math.min(t,r),c=Math.max(t,r);kt.push({xStart:e-10*mt[i],yStart:t,xEnd:e+5,yEnd:t+n-1,color:o,id:a,type:d}),kt.push({xStart:e+5+7,yStart:s+n+7-1,xEnd:e+5+7+Math.min(7,n)-1,yEnd:c-7+1,color:o,id:a,type:d}),kt.push({xStart:e-10*mt[i],yStart:r,xEnd:e+5,yEnd:r+n-1,color:o,id:a,type:d});var h="M "+(e+5)+" "+c;h+=" Q "+(e+5+7)+" "+c+" "+(e+5+7)+" "+(c-7),h+=" H "+(e+5+7+Math.min(7,n)),h+=" Q "+(e+5+7+Math.min(7,n))+" "+(c+n)+" "+(e+5)+" "+(c+n),h+=" Z ",bt.push({path:h,color:o,id:a,type:d}),h="M "+(e+5)+" "+s,h+=" Q "+(e+5+7+Math.min(7,n))+" "+s+" "+(e+5+7+Math.min(7,n))+" "+(s+n+7),h+=" H "+(e+5+7),h+=" Q "+(e+5+7)+" "+(s+n)+" "+(e+5)+" "+(s+n),h+=" Z ",bt.push({path:h,color:o,id:a,type:d}),mt[i]+=1}function le(e,t,r,n,o,a,i,d){var s=Math.min(t,r),c=Math.max(t,r);e-=10*yt[i],kt.push({xStart:e-6,yStart:t,xEnd:e+10*yt[i],yEnd:t+n-1,color:o,id:a,type:d}),kt.push({xStart:e-5-7-Math.min(7,n),yStart:s+n+7-1,xEnd:e-5-7-1,yEnd:c-7+1,color:o,id:a,type:d}),kt.push({xStart:e-6,yStart:r,xEnd:e+10*yt[i],yEnd:r+n-1,color:o,id:a,type:d});var h="M "+(e-5)+" "+c;h+=" Q "+(e-5-7)+" "+c+" "+(e-5-7)+" "+(c-7),h+=" H "+(e-5-7-Math.min(7,n)),h+=" Q "+(e-5-7-Math.min(7,n))+" "+(c+n)+" "+(e-5)+" "+(c+n),h+=" Z ",bt.push({path:h,color:o,id:a,type:d}),h="M "+(e-5)+" "+s,h+=" Q "+(e-5-7-Math.min(7,n))+" "+s+" "+(e-5-7-Math.min(7,n))+" "+(s+n+7),h+=" H "+(e-5-7),h+=" Q "+(e-5-7)+" "+(s+n)+" "+(e-5)+" "+(s+n),h+=" Z ",bt.push({path:h,color:o,id:a,type:d}),yt[i]+=1}function ue(e,t,r){void 0===r&&(r="haplo");var n=new Set;t.forEach(function(e){n.add(e.color)}),n.forEach(function(n){ve(t.filter(me("color",n)),r),be(e.filter(me("color",n)),r)})}function pe(e){var t=void 0,r=void 0;e.forEach(function(e){e.d="M "+(e.x-9)+" "+e.y+" Q "+(e.x-9)+" "+(e.y-9)+" "+e.x+" "+(e.y-9),t=e.x,r=e.y-9,e.width>1&&(t+=e.pixelWidth,e.d+=" L "+t+" "+r),e.d+=" Q "+(t+9)+" "+r+" "+(t+9)+" "+(r+9),t+=9,r+=9,e.contentHeight>0&&(r+=e.contentHeight-0,e.d+=" L "+t+" "+r),e.d+=" Q "+t+" "+(r+9)+" "+(t-9)+" "+(r+9),t-=9,r+=9,e.width>1&&(t-=e.pixelWidth,e.d+=" L "+t+" "+r),e.d+=" Q "+(t-9)+" "+r+" "+(t-9)+" "+(r-9),t-=9,r-=9,e.contentHeight>0&&(r-=e.contentHeight-0,e.d+=" L "+t+" "+r)}),
ot.selectAll(".node").data(e).enter().append("path").attr("id",function(e){return e.name}).attr("d",function(e){return e.d}).on("mouseover",qe).on("mouseout",Oe).on("dblclick",Ie).style("fill","#fff").style("fill-opacity",wt.showExonsFlag?"0.4":"0.6").style("stroke","black").style("stroke-width","2px").append("svg:title").text(function(e){return e.name})}function fe(e){0===wt.nodeWidthOption&&ot.selectAll("text").data(e).enter().append("text").attr("x",function(e){return e.x-4}).attr("y",function(e){return e.y+4}).text(function(e){return e.seq}).attr("font-family",'Courier, "Lucida Console", monospace').attr("font-size","14px").attr("fill","black").style("pointer-events","none")}function ge(){for(var e=0;ct[e].name!==Nt;)e+=1;var t=ct[e];ot.append("line").attr("x1",0).attr("y1",Ft-10).attr("x2",Ot).attr("y2",Ft-10).attr("stroke-width",1).attr("stroke","black");var r=100;0===wt.nodeWidthOption&&(r=20);var n=t.indexOfFirstBase,o=!1,a=-100;if(0!==wt.nodeWidthOption){var i=st[t.indexSequence[0]];a=de(i,0),ye(n,a),o=!0}t.indexSequence.forEach(function(e){for(var t=st[e],i=Math.ceil(n/r)*r;i<n+t.sequenceLength;){var d=de(t,i-n);a+80<=d&&(ye(i,d),o=!0,a=d),i+=r}n+=st[e].sequenceLength}),o||ye(t.indexOfFirstBase,st[t.indexSequence[0]].x-4)}function ye(e,t){ot.append("text").attr("x",t).attr("y",Ft-13).text("|"+e).attr("font-family",'Courier, "Lucida Console", monospace').attr("font-size","12px").attr("fill","black").style("pointer-events","none")}function me(e,t){return function(r){return r[e]===t}}function ve(e,t){void 0===t&&(t="haplo"),e=e.filter(me("type",t)),ot.selectAll("trackRectangles").data(e).enter().append("rect").attr("x",function(e){return e.xStart}).attr("y",function(e){return e.yStart}).attr("width",function(e){return e.xEnd-e.xStart+1}).attr("height",function(e){return e.yEnd-e.yStart+1}).style("fill",function(e){return e.color}).attr("trackID",function(e){return e.id}).attr("class",function(e){return"track"+e.id}).attr("color",function(e){return e.color}).on("mouseover",Se).on("mouseout",Fe).on("dblclick",Ne)}function we(e,t){return e[6]<t[6]?-1:e[6]>t[6]?1:0}function xe(){var e=ot.append("defs").append("pattern").attr({id:"patternA",width:"7",height:"7",patternUnits:"userSpaceOnUse",patternTransform:"rotate(45)"});e.append("rect").attr({x:"0",y:"0",width:"7",height:"7",fill:"#FFFFFF"}),e.append("rect").attr({x:"0",y:"0",width:"3",height:"3",fill:"#505050"}),e.append("rect").attr({x:"0",y:"4",width:"3",height:"3",fill:"#505050"}),e.append("rect").attr({x:"4",y:"0",width:"3",height:"3",fill:"#505050"}),e.append("rect").attr({x:"4",y:"4",width:"3",height:"3",fill:"#505050"}),e=ot.append("defs").append("pattern").attr({id:"patternB",width:"8",height:"8",patternUnits:"userSpaceOnUse",patternTransform:"rotate(45)"}),e.append("rect").attr({x:"0",y:"0",width:"8",height:"8",fill:"#FFFFFF"}),e.append("rect").attr({x:"0",y:"0",width:"3",height:"3",fill:"#1f77b4"}),e.append("rect").attr({x:"0",y:"5",width:"3",height:"3",fill:"#1f77b4"}),e.append("rect").attr({x:"5",y:"0",width:"3",height:"3",fill:"#1f77b4"}),e.append("rect").attr({x:"5",y:"5",width:"3",height:"3",fill:"#1f77b4"}),e=ot.append("defs").append("pattern").attr({id:"plaid0",width:"6",height:"6",patternUnits:"userSpaceOnUse",patternTransform:"rotate(45)"}),e.append("rect").attr({x:"0",y:"0",width:"6",height:"6",fill:"#FFFFFF"}),e.append("rect").attr({x:"0",y:"0",width:"2",height:"2",fill:"#1f77b4"}),e.append("rect").attr({x:"0",y:"4",width:"2",height:"2",fill:"#1f77b4"}),e.append("rect").attr({x:"4",y:"0",width:"2",height:"2",fill:"#1f77b4"}),e.append("rect").attr({x:"4",y:"4",width:"2",height:"2",fill:"#1f77b4"}),e=ot.append("defs").append("pattern").attr({id:"plaid1",width:"6",height:"6",patternUnits:"userSpaceOnUse",patternTransform:"rotate(45)"}),e.append("rect").attr({x:"0",y:"0",width:"6",height:"6",fill:"#FFFFFF"}),e.append("rect").attr({x:"0",y:"0",width:"2",height:"2",fill:"#ff7f0e"}),e.append("rect").attr({x:"0",y:"4",width:"2",height:"2",fill:"#ff7f0e"}),e.append("rect").attr({x:"4",y:"0",width:"2",height:"2",fill:"#ff7f0e"}),e.append("rect").attr({x:"4",y:"4",width:"2",height:"2",fill:"#ff7f0e"}),e=ot.append("defs").append("pattern").attr({id:"plaid2",width:"6",height:"6",patternUnits:"userSpaceOnUse",patternTransform:"rotate(45)"}),e.append("rect").attr({x:"0",y:"0",width:"6",height:"6",fill:"#FFFFFF"}),e.append("rect").attr({x:"0",y:"0",width:"2",height:"2",fill:"#2ca02c"}),e.append("rect").attr({x:"0",y:"4",width:"2",height:"2",fill:"#2ca02c"}),e.append("rect").attr({x:"4",y:"0",width:"2",height:"2",fill:"#2ca02c"}),e.append("rect").attr({x:"4",y:"4",width:"2",height:"2",fill:"#2ca02c"}),e=ot.append("defs").append("pattern").attr({id:"plaid3",width:"6",height:"6",patternUnits:"userSpaceOnUse",patternTransform:"rotate(45)"}),e.append("rect").attr({x:"0",y:"0",width:"6",height:"6",fill:"#FFFFFF"}),e.append("rect").attr({x:"0",y:"0",width:"2",height:"2",fill:"#d62728"}),e.append("rect").attr({x:"0",y:"4",width:"2",height:"2",fill:"#d62728"}),e.append("rect").attr({x:"4",y:"0",width:"2",height:"2",fill:"#d62728"}),e.append("rect").attr({x:"4",y:"4",width:"2",height:"2",fill:"#d62728"}),e=ot.append("defs").append("pattern").attr({id:"plaid4",width:"6",height:"6",patternUnits:"userSpaceOnUse",patternTransform:"rotate(45)"}),e.append("rect").attr({x:"0",y:"0",width:"6",height:"6",fill:"#FFFFFF"}),e.append("rect").attr({x:"0",y:"0",width:"2",height:"2",fill:"#9467bd"}),e.append("rect").attr({x:"0",y:"4",width:"2",height:"2",fill:"#9467bd"}),e.append("rect").attr({x:"4",y:"0",width:"2",height:"2",fill:"#9467bd"}),e.append("rect").attr({x:"4",y:"4",width:"2",height:"2",fill:"#9467bd"}),e=ot.append("defs").append("pattern").attr({id:"plaid5",width:"6",height:"6",patternUnits:"userSpaceOnUse",patternTransform:"rotate(45)"}),e.append("rect").attr({x:"0",y:"0",width:"6",height:"6",fill:"#FFFFFF"}),e.append("rect").attr({x:"0",y:"0",width:"2",height:"2",fill:"#8c564b"}),e.append("rect").attr({x:"0",y:"4",width:"2",height:"2",fill:"#8c564b"}),e.append("rect").attr({x:"4",y:"0",width:"2",height:"2",fill:"#8c564b"}),e.append("rect").attr({x:"4",y:"4",width:"2",height:"2",fill:"#8c564b"})}function Ee(e){void 0===e&&(e="haplo");var t=Et.filter(me("type",e));t.sort(we),t.forEach(function(e){var t=(e.xStart+e.xEnd)/2,r="M "+e.xStart+" "+e.yStart;r+=" C "+t+" "+e.yStart+" "+t+" "+e.yEnd+" "+e.xEnd+" "+e.yEnd,r+=" V "+(e.yEnd+e.width),r+=" C "+t+" "+(e.yEnd+e.width)+" "+t+" "+(e.yStart+e.width)+" "+e.xStart+" "+(e.yStart+e.width),r+=" Z",e.path=r}),ot.selectAll("trackCurves").data(Et).enter().append("path").attr("d",function(e){return e.path}).style("fill",function(e){return e.color}).attr("trackID",function(e){return e.id}).attr("class",function(e){return"track"+e.id}).attr("color",function(e){return e.color}).on("mouseover",Se).on("mouseout",Fe).on("dblclick",Ne)}function be(e,t){void 0===t&&(t="haplo"),e=e.filter(me("type",t)),ot.selectAll("trackCorners").data(e).enter().append("path").attr("d",function(e){return e.path}).style("fill",function(e){return e.color}).attr("trackID",function(e){return e.id}).attr("class",function(e){return"track"+e.id}).attr("color",function(e){return e.color}).on("mouseover",Se).on("mouseout",Fe).on("dblclick",Ne)}function ke(){for(var e='<table class="table-sm table-condensed table-nonfluid"><thead><tr><th>Color</th><th>Trackname</th><th>Show Track</th></tr></thead>',t=[],r=0;r<ct.length;r+=1)"haplo"===ct[r].type&&(e+='<tr><td style="text-align:right"><div class="color-box" style="background-color: '+oe(ct[r],"exon")+';"></div></td>',ct[r].hasOwnProperty("name")?e+="<td>"+ct[r].name+"</td>":e+="<td>"+ct[r].id+"</td>",e+='<td><input type="checkbox" checked=true id="showTrack'+r+'"></td>',t.push(r));e+="</table",$("#legendDiv").html(e),t.forEach(function(e){document.getElementById("showTrack"+e).addEventListener("click",function(){return i(e)},!1)})}function Se(){var e=d3.select(this).attr("trackID");d3.selectAll(".track"+e).style("fill","url(#patternA)")}function qe(){d3.select(this).style("stroke-width","4px")}function Fe(){var e=d3.select(this).attr("trackID");d3.selectAll(".track"+e).each(function(){var e=d3.select(this).attr("color");d3.select(this).style("fill",e)})}function Oe(){d3.select(this).style("stroke-width","2px")}function Ne(){for(var e=d3.select(this).attr("trackID"),t=0;t<it.length&&it[t].id!==Number(e);)t+=1;t>=it.length||(console.log("moving index: "+t),o(t),p())}function Ie(){var e=d3.select(this).attr("id");wt.clickableNodesFlag&&(ht&&wt.showReads?(document.getElementById("hgvmNodeID").value=e,document.getElementById("hgvmPostButton").click()):(document.getElementById("nodeID").value=e,document.getElementById("postButton").click()))}function Ce(e){var t=[];return e.node.forEach(function(e){t.push({name:""+e.id,sequenceLength:e.sequence.length,seq:e.sequence})}),t}function Me(){switch(st.forEach(function(e){e.hasOwnProperty("sequenceLength")||(e.sequenceLength=e.seq.length)}),wt.nodeWidthOption){case 1:st.forEach(function(e){e.width=1+Math.log(e.sequenceLength)/Math.log(2),e.pixelWidth=Math.round(8.401*(e.width-1))});break;case 2:st.forEach(function(e){e.width=e.sequenceLength/100,e.pixelWidth=Math.round(8.401*(e.width-1))});break;default:st.forEach(function(e){e.width=e.sequenceLength,ot.append("text").attr("x",0).attr("y",100).attr("id","dummytext").text(e.seq.substr(1)).attr("font-family",'Courier, "Lucida Console", monospace').attr("font-size","14px").attr("fill","black").style("pointer-events","none"),e.pixelWidth=Math.round(document.getElementById("dummytext").getComputedTextLength()),$("#dummytext").remove()})}}function Pe(e){var t=[];return e.path.forEach(function(e,r){var n=[],o=!0;e.mapping.forEach(function(e){e.position.hasOwnProperty("is_reverse")&&!0===e.position.is_reverse?n.push("-"+e.position.node_id):(n.push(""+e.position.node_id),o=!1)}),o&&(n.reverse(),n.forEach(function(e,t){n[t]=e.substr(1)}));var a={};a.id=r,a.sequence=n,e.hasOwnProperty("freq")&&(a.freq=e.freq),e.hasOwnProperty("name")&&(a.name=e.name),e.hasOwnProperty("indexOfFirstBase")&&(a.indexOfFirstBase=Number(e.indexOfFirstBase)),t.push(a)}),t}function Le(e,t,r){console.log(r);var n=[],o=[];e.forEach(function(e){o.push(parseInt(e.name,10))});for(var a=0;a<r.length;a+=1)!function(e){var a=r[e],i=[],d=[],s=-1,c=-1;if(a.path.mapping.forEach(function(t,r){if(o.indexOf(t.position.node_id)>-1){var n={},a=0;t.position.hasOwnProperty("is_reverse")&&!0===t.position.is_reverse?(i.push("-"+t.position.node_id),n.nodeName="-"+t.position.node_id):(i.push(""+t.position.node_id),n.nodeName=t.position.node_id.toString()),s<0&&(s=r,t.position.hasOwnProperty("offset")&&(a=t.position.offset)),c=r;var h=[],l=a;t.edit.forEach(function(n){n.hasOwnProperty("to_length")&&!n.hasOwnProperty("from_length")?h.push({type:"insertion",pos:l,seq:n.sequence}):!n.hasOwnProperty("to_length")&&n.hasOwnProperty("from_length")?h.push({type:"deletion",pos:l,length:n.from_length}):n.hasOwnProperty("sequence")&&(n.sequence.length>1&&console.log("found substitution at read "+e+", node "+r+" = "+t.position.node_id+", seq = "+n.sequence),h.push({type:"substitution",pos:l,seq:n.sequence})),n.hasOwnProperty("from_length")&&(l+=n.from_length)}),n.mismatches=h,d.push(n)}}),0===i.length)console.log("read "+e+" is empty");else{var h={};h.id=t.length+n.length,h.sequence=i,h.sequenceNew=d,h.type="read",a.path.hasOwnProperty("freq")&&(h.freq=a.path.freq),a.path.hasOwnProperty("name")&&(h.name=a.path.name),h.firstNodeOffset=0,a.path.mapping[s].position.hasOwnProperty("offset")&&(h.firstNodeOffset=a.path.mapping[s].position.offset);var l=a.path.mapping[c].edit;h.finalNodeCoverLength=0,a.path.mapping[c].position.hasOwnProperty("offset")&&(h.finalNodeCoverLength+=a.path.mapping[c].position.offset),l.forEach(function(e){e.hasOwnProperty("from_length")&&(h.finalNodeCoverLength+=e.from_length)}),n.push(h)}}(a);return n}function De(){for(var e=void 0,t=void 0,r=[],n=[],o=0;o<st.length;o+=1)r.push(new Set),n.push(new Set);var a=void 0;a=ht&&wt.showReads?ct.concat(ht):ct,a.forEach(function(o){for(var a=0;a<o.sequence.length;a+=1)"-"!==o.sequence[a].charAt(0)?(a>0?(e=o.sequence[a-1],r[pt.get(o.sequence[a])].add(e),"-"===e.charAt(0)&&r[pt.get(o.sequence[a])].add(e.substr(1))):"haplo"===o.type&&r[pt.get(o.sequence[a])].add("None"),a<o.sequence.length-1?(e=o.sequence[a+1],n[pt.get(o.sequence[a])].add(e),"-"===e.charAt(0)&&n[pt.get(o.sequence[a])].add(e.substr(1))):"haplo"===o.type&&n[pt.get(o.sequence[a])].add("None")):(e=o.sequence[a].substr(1),a>0?(t=o.sequence[a-1],"-"===t.charAt(0)?n[pt.get(e)].add(t.substr(1)):(n[pt.get(e)].add(t),n[pt.get(e)].add("-"+t))):"haplo"===o.type&&n[pt.get(e)].add("None"),a<o.sequence.length-1?(t=o.sequence[a+1],"-"===t.charAt(0)?r[pt.get(e)].add(t.substr(1)):(r[pt.get(e)].add(t),r[pt.get(e)].add("-"+t))):"haplo"===o.type&&r[pt.get(e)].add("None"))});for(var i=0;i<st.length;i+=1)n[i]=Array.from(n[i]),r[i]=Array.from(r[i]);if(ht&&wt.showReads){var d=st.slice();d.sort(X);var s=new Map,c=new Map;d.forEach(function(e){var t=Ae(pt.get(e.name),r,n);t?(s.set(e.name,s.get(t)+st[pt.get(t)].sequenceLength),c.set(e.name,c.get(t))):(s.set(e.name,0),c.set(e.name,e.name))}),ht.forEach(function(e){e.firstNodeOffset+=s.get(e.sequence[0]),e.finalNodeCoverLength+=s.get(e.sequence[e.sequence.length-1]);for(var t=e.sequence.length-1;t>=0;t-=1)Ae(pt.get(e.sequence[t]),r,n)&&function(){var o=Ae(pt.get(e.sequence[t]),r,n);Be(pt.get(o),r,n)&&(t>0?(e.sequence.splice(t,1),e.sequenceNew[t].mismatches.forEach(function(e){e.pos+=st[pt.get(o)].sequenceLength}),e.sequenceNew[t-1].mismatches=e.sequenceNew[t-1].mismatches.concat(e.sequenceNew[t].mismatches),e.sequenceNew.splice(t,1)):(e.sequence[0]=c.get(e.sequence[0]),e.sequenceNew[t].mismatches.forEach(function(t){t.pos+=s.get(e.sequenceNew[0].nodeName)}),e.sequenceNew[0].nodeName=c.get(e.sequenceNew[0].nodeName)))}()})}for(var h=0;h<st.length;h+=1)if(Be(h,r,n)&&!Ae(h,r,n))for(var l=h;Be(l,r,n);)l=n[l][0],"-"===l.charAt(0)&&(l=l.substr(1)),l=pt.get(l),st[h].hasOwnProperty("sequenceLength")?st[h].sequenceLength+=st[l].sequenceLength:st[h].width+=st[l].width,st[h].seq+=st[l].seq;ct.forEach(function(t){for(var o=t.sequence.length-1;o>=0;o-=1){e=t.sequence[o],"-"===e.charAt(0)&&(e=e.substr(1));Ae(pt.get(e),r,n)&&t.sequence.splice(o,1)}});for(var u=st.length-1;u>=0;u-=1)Ae(u,r,n)&&st.splice(u,1)}function Ae(e,t,r){if(1!==t[e].length)return!1;if("None"===t[e][0])return!1;var n=t[e][0];"-"===n.charAt(0)&&(n=n.substr(1));var o=pt.get(n);return 1===r[o].length&&("None"!==r[o][0]&&n)}function Be(e,t,r){if(1!==r[e].length)return!1;if("None"===r[e][0])return!1;var n=r[e][0];"-"===n.charAt(0)&&(n=n.substr(1));var o=pt.get(n);return 1===t[o].length&&"None"!==t[o][0]}function Re(){ct.forEach(function(e,t){"read"===e.type&&e.sequenceNew.forEach(function(t,r){t.mismatches.forEach(function(n){for(var o=pt.get(t.nodeName),a=st[o],i=de(a,n.pos),d=r;e.path[d].node!==o;)d+=1;var s=e.path[d].y;if("insertion"===n.type)!wt.showSoftClips&&(n.pos===e.firstNodeOffset&&0===r||n.pos===e.finalNodeCoverLength&&r===e.sequenceNew.length-1)||Te(i-3,s+7,n.seq,a.y);else if("deletion"===n.type){var c=de(a,n.pos+n.length);He(i,c,s+4,a.y)}else if("substitution"===n.type){var h=de(a,n.pos+n.seq.length);_e(i+1,h,s+7,a.y,n.seq)}})})})}function Te(e,t,r,n){ot.append("text").attr("x",e).attr("y",t).text("*").attr("font-family",'Courier, "Lucida Console", monospace').attr("font-size","12px").attr("fill","black").attr("nodeY",n).on("mouseover",$e).on("mouseout",je).append("svg:title").text(r)}function _e(e,t,r,n,o){ot.append("text").attr("x",e).attr("y",r).text(o).attr("font-family",'Courier, "Lucida Console", monospace').attr("font-size","12px").attr("fill","black").attr("nodeY",n).attr("rightX",t).on("mouseover",We).on("mouseout",Qe)}function He(e,t,r,n){ot.append("line").attr("x1",e).attr("y1",r-1).attr("x2",t).attr("y2",r-1).attr("stroke-width",7).attr("stroke","grey").attr("nodeY",n).on("mouseover",Ue).on("mouseout",Ye)}function $e(){d3.select(this).attr("fill","red");var e=Number(d3.select(this).attr("x")),t=Number(d3.select(this).attr("y")),r=Number(d3.select(this).attr("nodeY"));ot.append("line").attr("class","insertionHighlight").attr("x1",e+4).attr("y1",t-10).attr("x2",e+4).attr("y2",r+5).attr("stroke-width",1).attr("stroke","black")}function Ue(){d3.select(this).attr("stroke","red");var e=Number(d3.select(this).attr("x1")),t=Number(d3.select(this).attr("x2")),r=Number(d3.select(this).attr("y1")),n=Number(d3.select(this).attr("nodeY"));ot.append("line").attr("class","deletionHighlight").attr("x1",e).attr("y1",r-3).attr("x2",e).attr("y2",n+5).attr("stroke-width",1).attr("stroke","black"),ot.append("line").attr("class","deletionHighlight").attr("x1",t).attr("y1",r-3).attr("x2",t).attr("y2",n+5).attr("stroke-width",1).attr("stroke","black")}function We(){d3.select(this).attr("fill","red");var e=Number(d3.select(this).attr("x")),t=Number(d3.select(this).attr("rightX")),r=Number(d3.select(this).attr("y")),n=Number(d3.select(this).attr("nodeY"));ot.append("line").attr("class","substitutionHighlight").attr("x1",e-1).attr("y1",r-7).attr("x2",e-1).attr("y2",n+5).attr("stroke-width",1).attr("stroke","black"),ot.append("line").attr("class","substitutionHighlight").attr("x1",t+1).attr("y1",r-7).attr("x2",t+1).attr("y2",n+5).attr("stroke-width",1).attr("stroke","black")}function je(){d3.select(this).attr("fill","black"),d3.selectAll(".insertionHighlight").remove()}function Ye(){d3.select(this).attr("stroke","grey"),d3.selectAll(".deletionHighlight").remove()}function Qe(){d3.select(this).attr("fill","black"),d3.selectAll(".substitutionHighlight").remove()}Object.defineProperty(r,"__esModule",{value:!0}),r.create=n,r.changeTrackVisibility=i,r.changeExonVisibility=d,r.setMergeNodesFlag=s,r.setSoftClipsFlag=c,r.setShowReadsFlag=h,r.setColorSet=l,r.setNodeWidthOption=u,r.useColorScheme=te,r.vgExtractNodes=Ce,r.vgExtractTracks=Pe,r.vgExtractReads=Le;var Je=!1,ze=["#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525","#000000"],Ve=["#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#08519c","#08306b"],Ze=["#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#a50f15","#67000d"],Ge=["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"],Xe=["#ABCCE3","#FFCFA5","#B0DBB0","#F0AEAE","#D7C6E6","#C6ABA5","#F4CCE8","#CFCFCF","#E6E6AC","#A8E7ED"],Ke=[],et=[],tt=[],rt=[],nt=void 0,ot=void 0,at=[],it=[],dt=[],st=void 0,ct=void 0,ht=void 0,lt=void 0,ut=void 0,pt=void 0,ft=void 0,gt=[],yt=[],mt=[],vt=void 0,wt={mergeNodesFlag:!0,clickableNodesFlag:!1,showExonsFlag:!1,colorScheme:0,nodeWidthOption:0,showReads:!0,showSoftClips:!0,haplotypeColors:"greys",forwardReadColors:"reds",reverseReadColors:"blues",exonColors:"lightColors",hideLegendFlag:!1},xt=[],Et=[],bt=[],kt=[],St=[],qt=0,Ft=0,Ot=0,Nt=void 0,It=void 0},{}],3:[function(e,t,r){t.exports={BACKEND_URL:!1,DATA_SOURCES:[{name:"snp1kg-BRCA1",xgFile:"snp1kg-BRCA1.vg.xg",gamIndex:"NA12878-BRCA1.gam.index",anchorTrackName:"17",useMountedPath:!1,defaultPosition:"1"},{name:"cactus",xgFile:"cactus.vg.xg",gamIndex:"cactus-NA12879.gam.index",anchorTrackName:"ref",useMountedPath:!1,defaultPosition:"1"},{name:'vg "small" example',xgFile:"x.vg.xg",gbwtFile:"x.vg.gbwt",anchorTrackName:"x",useMountedPath:!1,defaultPosition:"1"}]}},{}],4:[function(e,t,r){t.exports={BACKEND_URL:"https://api.wbeyer.com",DATA_SOURCES:[{name:"chr22_v4",xgFile:"chr22_v4.vg.xg",gamIndex:"NA12878_mapped_v4.gam.index",anchorTrackName:"22",useMountedPath:!1,defaultPosition:"17697661"}]}},{}],5:[function(e,t,r){var n={}.constructor,o=function(e){return!(!e||e.constructor!==n)};r.isJSON=o;var a=function(e,t){var r=null;if(o(t)){if(r={},o(e))for(var n in e)r[n]=e[n];for(var n in t)"object"==typeof r[n]&&"object"==typeof t?r[n]=a(r[n],t[n]):r[n]=t[n]}else if(Array.isArray(e)&&Array.isArray(t)){r=e;for(var i=0;i<t.length;i++)-1===r.indexOf(t[i])&&(r[r.length]=t[i])}else r=t;return r};r.merge=a},{}]},{},[1]);
//# sourceMappingURL=main.js.map
